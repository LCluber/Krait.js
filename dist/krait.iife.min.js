/** MIT License
* 
* Copyright (c) 2015 Ludovic CLUBER 
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* http://kraitjs.lcluber.com
*/

var Krait=function(t){"use strict";function n(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!s(t,!1)&&(n&&t>=0&&t<=255||t>=0&&t<=127)}function s(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=parseInt(t,10);return n?t===s:t==s}var e=function(){function t(){this.pressed=!1}return t.prototype.down=function(t,n){n&&t.preventDefault(),this.pressed=!0},t.prototype.up=function(){this.pressed=!1},t}(),r=function(){function t(t,n,s){this.length=0,this.keys={},this.setCtrlKeys(t),this.setKeys(n),this.preventDefault=s}return t.prototype.start=function(t){if(this.keys.hasOwnProperty(t.which)){if(this.keys[t.which].down(t,this.preventDefault),this.length>1)for(var n in this.keys)if(this.keys.hasOwnProperty(n)&&!this.keys[n].pressed)return!1;if(this.ctrlKeys.ctrl===t.ctrlKey&&this.ctrlKeys.alt===t.altKey&&this.ctrlKeys.shift===t.shiftKey)return!0}return!1},t.prototype.stop=function(t){return!!this.keys.hasOwnProperty(t)&&(this.keys[t].up(),!0)},t.prototype.setCtrlKeys=function(t){this.ctrlKeys={ctrl:t.ctrl,alt:t.alt,shift:t.shift}},t.prototype.setKeys=function(t){for(var n=0,s=t;n<s.length;n++){var r=s[n];this.keys[r]=new e}this.length=t.length},t.prototype.getKeysAscii=function(){return Object.keys(this.keys)},t}(),i=function(){function t(t,n){this.ctrlKeys={ctrl:!1,alt:!1,shift:!1},this.setCtrlKeys(t),this.asciiCodes=n}return t.prototype.setCtrlKeys=function(t){for(var n in this.ctrlKeys)this.ctrlKeys.hasOwnProperty(n)&&(this.ctrlKeys[n]=!!(t&&t.hasOwnProperty(n)&&t[n]))},t}(),o=function(){function t(n,s,e,o,u){this.name=n,this.started=!1;var p=t.getAsciiCodes(e);if(p){this.defaultInputs=new i(s,p);var h=!!(u&&u.hasOwnProperty("preventDefault")&&u.preventDefault);this.inputs=new r(this.defaultInputs.ctrlKeys,p,h),this.callback=o,u&&u.hasOwnProperty("scope")&&(this.callback=this.callback.bind(u.scope))}}return t.prototype.start=function(t){return!!this.inputs.start(t)&&(this.started=!0,this.callback(this.started),this.started)},t.prototype.stop=function(t){return!(!this.inputs.stop(t)||!this.started)&&(this.started=!1,this.callback(this.started),!0)},t.prototype.setInputs=function(n,s){var e=t.getAsciiCodes(s);return!!e&&(this.inputs.setCtrlKeys(n),this.inputs.setKeys(e),!0)},t.prototype.getInputsAscii=function(){return this.inputs.getKeysAscii()},t.prototype.default=function(){this.inputs.setCtrlKeys(this.defaultInputs.ctrlKeys),this.inputs.setKeys(this.defaultInputs.asciiCodes)},t.getAsciiCodes=function(n){for(var s=[],e=0,r=n;e<r.length;e++){var i=r[e],o=t.inputValidation(i);if(!o)return!1;s.push(o)}return s},t.inputValidation=function(e){return s(e,!1)||(e=t.toASCII(e)),!!n(e)&&e},t.toASCII=function(t){return t.charCodeAt(0)},t}(),u=function(){function t(t){this.name=t,this.commands=[],this.watch=!1}return t.prototype.down=function(t){if(this.watch)for(var n=0,s=this.commands;n<s.length;n++)s[n].start(t)},t.prototype.up=function(t){if(this.watch)for(var n=0,s=this.commands;n<s.length;n++)s[n].stop(t)},t.prototype.addCommand=function(n,s,e,r,i){var u=new o(n,s,e,r,i);return this.commands.push(u),this.commands=t.sortCommands(this.commands),u},t.prototype.setInputs=function(n,s,e){var r=this.getCommand(n);return!!r&&(r.setInputs(s,e),this.commands=t.sortCommands(this.commands),!0)},t.prototype.default=function(n){var s=this.getCommand(n);return!!s&&(s.default(),this.commands=t.sortCommands(this.commands),!0)},t.prototype.getCommand=function(t){for(var n=0,s=this.commands;n<s.length;n++){var e=s[n];if(e.name==t)return e}return null},t.prototype.getCommandInputs=function(t){var n=this.getCommand(t);return!!n&&n.getInputsAscii()},t.sortCommands=function(t){return t.sort(function(t,n){return n.inputs.length-t.inputs.length}),t},t}(),p=function(){function t(){this.initListeners(),this.groups=[]}return t.prototype.initListeners=function(){var t=this;document.onkeydown=function(n){t.down(n)},document.onkeyup=function(n){t.up(n)}},t.prototype.down=function(t){for(var n=0,s=this.groups;n<s.length;n++)s[n].down(t)},t.prototype.up=function(t){for(var n=0,s=this.groups;n<s.length;n++)s[n].up(t.which)},t.prototype.watch=function(t){var n=this.getGroup(t);return!!n&&(n.watch=!0)},t.prototype.ignore=function(t){var n=this.getGroup(t);return!n||(n.watch=!1)},t.prototype.addCommand=function(t,n,s,e,r,i){var o=this.getGroup(t);return o||(o=new u(t),this.groups.push(o)),o.addCommand(n,s,e,r,i)},t.prototype.setInputs=function(t,n,s,e){var r=this.getGroup(t);return!!r&&r.setInputs(n,s,e)},t.prototype.default=function(t,n){var s=this.getGroup(t);return!!s&&s.default(n)},t.prototype.getGroup=function(t){for(var n=0,s=this.groups;n<s.length;n++){var e=s[n];if(e.name==t)return e}return null},t.prototype.getCommand=function(t,n){var s=this.getGroup(t);return s?s.getCommand(n):null},t.prototype.getCommandInputsAscii=function(t,n){var s=this.getCommand(t,n);return!!s&&s.getInputsAscii()},t}();return t.Keyboard=p,t}({});
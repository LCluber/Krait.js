/** MIT License
* 
* Copyright (c) 2015 Ludovic CLUBER 
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* http://kraitjs.lcluber.com
*/

var Krait=function(t){"use strict";function n(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!e(t,!1)&&(n&&t>=0&&t<=255||t>=0&&t<=127)}function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=parseInt(t,10);return n?t===e:t==e}function r(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function o(t){return t<10?"0"+t:t}function i(){var t=new Date,n=[o(t.getMonth()+1),o(t.getDate()),t.getFullYear().toString().substr(-2)],e=[o(t.getHours()),o(t.getMinutes()),o(t.getSeconds())];return n.join("/")+" "+e.join(":")}var s=function(){function t(t,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(n,e,r){return e&&t(n.prototype,e),r&&t(n,r),n}}(),u={info:{id:1,name:"info",color:"#28a745"},trace:{id:2,name:"trace",color:"#17a2b8"},warn:{id:3,name:"warn",color:"#ffc107"},error:{id:4,name:"error",color:"#dc3545"},off:{id:99,name:"off",color:null}},a=function(){function t(n,e){r(this,t),this.id=n.id,this.name=n.name,this.color=n.color,this.content=e,this.date=i()}return s(t,[{key:"display",value:function(t){console[this.name]("%c["+t+"] "+this.date+" : ","color:"+this.color+";",this.content)}}]),t}(),h=function(){function t(n,e){r(this,t),this.messages=[],this.name=n,this.messages=[],this.level=e}return s(t,[{key:"setLevel",value:function(t){return this.level=u.hasOwnProperty(t)?u[t]:this.level,this.getLevel()}},{key:"getLevel",value:function(){return this.level.name}},{key:"info",value:function(t){this.log(u.info,t)}},{key:"trace",value:function(t){this.log(u.trace,t)}},{key:"warn",value:function(t){this.log(u.warn,t)}},{key:"error",value:function(t){this.log(u.error,t)}},{key:"log",value:function(t,n){var e=new a(t,n);this.messages.push(e),this.level.id<=e.id&&e.display(this.name)}}]),t}(),c=function(){function t(){r(this,t)}return s(t,null,[{key:"setLevel",value:function(n){t.level=u.hasOwnProperty(n)?u[n]:t.level;var e=!0,r=!1,o=void 0;try{for(var i,s=t.groups[Symbol.iterator]();!(e=(i=s.next()).done);e=!0)i.value.setLevel(t.level.name)}catch(t){r=!0,o=t}finally{try{!e&&s.return&&s.return()}finally{if(r)throw o}}return t.getLevel()}},{key:"getLevel",value:function(){return t.level.name}},{key:"getGroup",value:function(n){var e=!0,r=!1,o=void 0;try{for(var i,s=t.groups[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var u=i.value;if(u.name===n)return u}}catch(t){r=!0,o=t}finally{try{!e&&s.return&&s.return()}finally{if(r)throw o}}return null}},{key:"addGroup",value:function(t){return this.getGroup(t)||this.pushGroup(t)}},{key:"pushGroup",value:function(n){var e=new h(n,t.level);return t.groups.push(e),e}}]),t}();c.level=u.error,c.groups=[];var l=function(){function t(){this.pressed=!1}return t.prototype.down=function(t){t.preventDefault(),this.pressed=!0},t.prototype.up=function(){this.pressed=!1},t}(),p=function(){function t(t,n){this.length=0,this.keys={},this.ctrlKeys={ctrl:!1,alt:!1,shift:!1},this.set(t,n)}return t.prototype.start=function(t){if(this.keys.hasOwnProperty(t.which)){if(this.keys[t.which].down(t),this.length>1)for(var n in this.keys)if(this.keys.hasOwnProperty(n)&&!this.keys[n].pressed)return!1;if(this.ctrlKeys.ctrl===t.ctrlKey&&this.ctrlKeys.alt===t.altKey&&this.ctrlKeys.shift===t.shiftKey)return!0}return!1},t.prototype.stop=function(t){return!!this.keys.hasOwnProperty(t)&&(this.keys[t].up(),!0)},t.prototype.set=function(t,n){this.keys={};for(var e in this.ctrlKeys)this.ctrlKeys.hasOwnProperty(e)&&(this.ctrlKeys[e]=!!(t&&t.hasOwnProperty(e)&&t[e]));for(var r=0,o=n;r<o.length;r++){var i=o[r];this.keys[i]=new l}this.length=n.length},t.prototype.getKeysAscii=function(){return Object.keys(this.keys)},t}(),f=function(){function t(t,n,e,r,o){this.name=t,this.started=!1;var i=this.getAsciiCodes(e);i&&(this.inputs=new p(n,i),this.defaultInputs={ctrlKeys:n,asciiCodes:i},this.callback=r,o&&(this.callback=this.callback.bind(o)),this.log=c.addGroup("Krait"),this.log.info("Added new command "+this.name))}return t.prototype.start=function(t){return!!this.inputs.start(t)&&(this.started=!0,this.callback(this.started),this.started)},t.prototype.stop=function(t){return!(!this.inputs.stop(t)||!this.started)&&(this.started=!1,this.callback(this.started),!0)},t.prototype.setInputs=function(t,n){var e=this.getAsciiCodes(n);return!!e&&(this.inputs.set(t,e),this.log.info(this.name+" is now set to "+JSON.stringify(e)),!0)},t.prototype.getInputsAscii=function(){return this.inputs.getKeysAscii()},t.prototype.default=function(){this.inputs.set(this.defaultInputs.ctrlKeys,this.defaultInputs.asciiCodes),this.log.info(this.name+" is now set to default"+JSON.stringify(this.defaultInputs.asciiCodes))},t.prototype.getAsciiCodes=function(t){for(var n=[],e=0,r=t;e<r.length;e++){var o=r[e],i=this.inputValidation(o);if(!i)return!1;n.push(i)}return n},t.prototype.inputValidation=function(t){return e(t,!1)||(t=this.toASCII(t)),n(t)?t:(this.log.error(t+" is not assignable to a valid ASCII code"),!1)},t.prototype.toASCII=function(t){return t.charCodeAt(0)},t}(),d=function(){function t(t){this.name=t,this.commands=[],this.listen=!1}return t.prototype.down=function(t){if(this.listen)for(var n=0,e=this.commands;n<e.length;n++)e[n].start(t)},t.prototype.up=function(t){if(this.listen)for(var n=0,e=this.commands;n<e.length;n++)e[n].stop(t)},t.prototype.start=function(){return this.listen=!0},t.prototype.stop=function(){return this.listen=!1,!0},t.prototype.addCommand=function(t,n,e,r,o){var i=new f(t,n,e,r,o);return this.commands.push(i),this.commands=this.sortCommands(this.commands),i},t.prototype.setInputs=function(t,n,e){var r=this.getCommand(t);return!!r&&(r.setInputs(n,e),this.commands=this.sortCommands(this.commands),!0)},t.prototype.default=function(t){var n=this.getCommand(t);return!!n&&(n.default(),this.commands=this.sortCommands(this.commands),!0)},t.prototype.sortCommands=function(t){return t.sort(function(t,n){return n.inputs.length-t.inputs.length}),t},t.prototype.getCommand=function(t){for(var n=0,e=this.commands;n<e.length;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.getCommandInputsAscii=function(t){var n=this.getCommand(t);return!!n&&n.getInputsAscii()},t}(),y=function(){function t(){this.initListeners(),this.groups=[]}return t.prototype.initListeners=function(){var t=this;document.onkeydown=function(n){t.down(n)},document.onkeyup=function(n){t.up(n)}},t.prototype.down=function(t){for(var n=0,e=this.groups;n<e.length;n++)e[n].down(t)},t.prototype.up=function(t){for(var n=0,e=this.groups;n<e.length;n++)e[n].up(t.which)},t.prototype.start=function(t){var n=this.getGroup(t);return!!n&&n.start()},t.prototype.stop=function(t){var n=this.getGroup(t);return!!n&&n.stop()},t.prototype.addCommand=function(t,n,e,r,o,i){var s=this.getGroup(t);return s||(s=new d(t),this.groups.push(s)),s.addCommand(n,e,r,o,i)},t.prototype.setInputs=function(t,n,e,r){var o=this.getGroup(t);return!!o&&o.setInputs(n,e,r)},t.prototype.default=function(t,n){var e=this.getGroup(t);return!!e&&e.default(n)},t.prototype.getGroup=function(t){for(var n=0,e=this.groups;n<e.length;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.getCommand=function(t,n){var e=this.getGroup(t);return e?e.getCommand(n):null},t.prototype.getCommandInputsAscii=function(t,n){var e=this.getCommand(t,n);return!!e&&e.getInputsAscii()},t}();return t.Keyboard=y,t}({});
/** MIT License
* 
* Copyright (c) 2015 Ludovic CLUBER 
* 
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*
* http://kraitjs.lcluber.com
*/

var Krait=function(t){"use strict";function e(t){return null!==t&&t.constructor===Array}function n(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!!o(t,!1)&&(e&&t>=0&&t<=255||t>=0&&t<=127)}function o(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=parseInt(t,10);return e?t===n:t==n}function r(t){return"string"==typeof t}function s(t){return!!t&&("object"===("undefined"==typeof HTMLElement?"undefined":h(HTMLElement))?t instanceof HTMLElement:t&&"object"===(void 0===t?"undefined":h(t))&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName)}function i(t){switch(t){case"onafterprint":case"onbeforeprint":case"onbeforeunload":case"onerror":case"onhashchange":case"onload":case"onmessage":case"onoffline":case"ononline":case"onpagehide":case"onpageshow":case"onpopstate":case"onresize":case"onstorage":case"onunload":case"onblur":case"onchange":case"oncontextmenu":case"onfocus":case"oninput":case"oninvalid":case"onreset":case"onsearch":case"onselect":case"onsubmit":case"onkeydown":case"onkeypress":case"onkeyup":case"onclick":case"ondblclick":case"onmousedown":case"onmousemove":case"onmouseout":case"onmouseover":case"onmouseup":case"onmousewheel":case"onwheel":case"ondrag":case"ondragend":case"ondragenter":case"ondragleave":case"ondragover":case"ondragstart":case"ondrop":case"onscroll":case"oncopy":case"oncut":case"onpaste":case"onabort":case"oncanplay":case"oncanplaythrough":case"oncuechange":case"ondurationchange":case"onemptied":case"onended":case"onerror":case"onloadeddata":case"onloadedmetadata":case"onloadstart":case"onpause":case"onplay":case"onplaying":case"onprogress":case"onratechange":case"onseeked":case"onseeking":case"onstalled":case"onsuspend":case"ontimeupdate":case"onvolumechange":case"onwaiting":case"ontoggle":return!0;default:return!1}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t){return t<10?"0"+t:t}function l(){var t=new Date,e=[c(t.getMonth()+1),c(t.getDate()),t.getFullYear().toString().substr(-2)],n=[c(t.getHours()),c(t.getMinutes()),c(t.getSeconds())];return e.join("/")+" "+n.join(":")}var h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},f=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),p=function(){function t(){a(this,t)}return f(t,null,[{key:"scrollToBottom",value:function(t){t.scrollTop=t.scrollHeight}},{key:"scrollToTop",value:function(t){t.scrollTop=0}},{key:"findById",value:function(t){return document.getElementById(t)}},{key:"findByClass",value:function(t){return this.arrayFrom(document.getElementsByClassName(t))}},{key:"findByTag",value:function(t){return this.arrayFrom(document.getElementsByTagName(t))}},{key:"showElement",value:function(t){return this.styleElement(t,"display","block")}},{key:"hideElement",value:function(t){return this.styleElement(t,"display","none")}},{key:"styleElement",value:function(t,e,n){var o=this.checkElement(t);return o&&(o.style[e]=n),o}},{key:"showOverflow",value:function(){document.body.style.overflow="visible"}},{key:"hideOverflow",value:function(){document.body.style.overflow="hidden"}},{key:"getInputValue",value:function(t){var e=this.checkElement(t);return e?e.value:null}},{key:"clearInputValue",value:function(t){var e=this.checkElement(t);return e&&(e.value=""),e}},{key:"focusOn",value:function(t){var e=this.checkElement(t);return e&&e.focus(),e}},{key:"addHTMLElement",value:function(t,e,n){var o=this.checkElement(t);if(o){var r=document.createElement(e);return n&&Object.keys(n).forEach(function(t){"textContent"===t||"innerHTML"===t||i(t)?r[t]=n[t]:r.setAttribute(t,n[t])}),o.appendChild(r),r}return null}},{key:"clearHTMLElement",value:function(t){var e=this.checkElement(t);return e&&(e.innerHTML=""),e}},{key:"arrayFrom",value:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e}},{key:"checkElement",value:function(t){return r(t)?this.findById(t):t}}]),t}(),y=(function(){function t(e,n,o){a(this,t),this._value="",this.elements=this.getElements(e),this.property=[],this.lastProperty="",n&&(this.property=n.split("."),this.lastProperty=this.property[this.property.length-1],this.addPropertyToElement()),this.value=o}f(t,[{key:"addPropertyToElement",value:function(){if(this.elements)for(var t=0;t<this.elements.length;t++)for(var e=0;e<this.property.length-1;e++)this.elements[t]=this.elements[t][this.property[e]]}},{key:"update",value:function(t){this.value=t}},{key:"updateDom",value:function(){if(this.elements){var t=this._value,e=!0,n=!1,o=void 0;try{for(var s,i=this.elements[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var a=s.value;if(this.property.length)this.property.length>1?a[this.lastProperty]=t:a.setAttribute(this.lastProperty,t);else if(a.hasAttribute("value"))a.value=t;else{var u=/<\s*.*[^>]*>(.*?)<\s*.*\s*>/gi;r(this._value)&&t.match(u)?a.innerHTML=t:a.textContent=t}}}catch(t){n=!0,o=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw o}}}}},{key:"getElements",value:function(t){var n=[];if(e(t)){var o=!0,i=!1,a=void 0;try{for(var u,c=t[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=u.value;s(l)&&n.push(l)}}catch(t){i=!0,a=t}finally{try{!o&&c.return&&c.return()}finally{if(i)throw a}}}else if(r(t)){var h=p.findById(t);h?n.push(h):n=p.findByClass(t)}else s(t)&&n.push(t);return n}},{key:"value",set:function(t){this._value=t,this.updateDom()},get:function(){return this._value}}])}(),function(){function t(){a(this,t)}return f(t,null,[{key:"ucfirst",value:function(t){return t.charAt(0).toUpperCase()+t.slice(1)}},{key:"toASCII",value:function(t){return t.charCodeAt(0)}}]),t}()),d=(function(){function t(){a(this,t)}f(t,null,[{key:"removeTrailingSlash",value:function(t){return t.replace(/\/+$/,"")}},{key:"getName",value:function(t){return t.replace(/^.*[\\\/]/,"")}},{key:"getExtension",value:function(t){return t.split(".").pop()}},{key:"getDirectory",value:function(t){return t.replace(/[^\\\/]*$/,"")}},{key:"checkExtension",value:function(t,e){var n=!0,o=!1,r=void 0;try{for(var s,i=e[Symbol.iterator]();!(n=(s=i.next()).done);n=!0)if(t===s.value)return!0}catch(t){o=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}return!1}}])}(),function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}()),m={info:{id:1,name:"info",color:"#28a745"},trace:{id:2,name:"trace",color:"#17a2b8"},warn:{id:3,name:"warn",color:"#ffc107"},error:{id:4,name:"error",color:"#dc3545"},off:{id:99,name:"off",color:null}},v=function(){function t(e,n){u(this,t),this.id=e.id,this.name=e.name,this.color=e.color,this.content=n,this.date=l()}return d(t,[{key:"display",value:function(t){console[this.name]("%c["+t+"] "+this.date+" : ","color:"+this.color+";",this.content)}}]),t}(),g=function(){function t(e,n){u(this,t),this.messages=[],this.name=e,this.messages=[],this._level=n}return d(t,[{key:"info",value:function(t){this.log(m.info,t)}},{key:"trace",value:function(t){this.log(m.trace,t)}},{key:"warn",value:function(t){this.log(m.warn,t)}},{key:"error",value:function(t){this.log(m.error,t)}},{key:"log",value:function(t,e){var n=new v(t,e);this.messages.push(n),this._level.id<=n.id&&n.display(this.name)}},{key:"level",set:function(t){this._level=m.hasOwnProperty(t)?m[t]:this._level},get:function(){return this._level.name}}]),t}(),k=function(){function t(){u(this,t)}return d(t,null,[{key:"setLevel",value:function(e){t.level=m.hasOwnProperty(e)?m[e]:t.level;var n=!0,o=!1,r=void 0;try{for(var s,i=t.groups[Symbol.iterator]();!(n=(s=i.next()).done);n=!0)s.value.level=t.level.name}catch(t){o=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}return t.getLevel()}},{key:"getLevel",value:function(){return t.level.name}},{key:"getGroup",value:function(e){var n=!0,o=!1,r=void 0;try{for(var s,i=t.groups[Symbol.iterator]();!(n=(s=i.next()).done);n=!0){var a=s.value;if(a.name===e)return a}}catch(t){o=!0,r=t}finally{try{!n&&i.return&&i.return()}finally{if(o)throw r}}return null}},{key:"addGroup",value:function(t){return this.getGroup(t)||this.pushGroup(t)}},{key:"pushGroup",value:function(e){var n=new g(e,t.level);return t.groups.push(n),n}}]),t}();k.level=m.error,k.groups=[];var w=function(){function t(){this.pressed=!1}return t.prototype.down=function(t){t.preventDefault(),this.pressed=!0},t.prototype.up=function(){this.pressed=!1},t}(),b=function(){function t(t,e){this.length=0,this.keys={},this.ctrlKeys={ctrl:!1,alt:!1,shift:!1},this.set(t,e)}return t.prototype.start=function(t){if(this.keys.hasOwnProperty(t.which)){if(this.keys[t.which].down(t),this.length>1)for(var e in this.keys)if(this.keys.hasOwnProperty(e)&&!this.keys[e].pressed)return!1;if(this.ctrlKeys.ctrl===t.ctrlKey&&this.ctrlKeys.alt===t.altKey&&this.ctrlKeys.shift===t.shiftKey)return!0}return!1},t.prototype.stop=function(t){return!!this.keys.hasOwnProperty(t)&&(this.keys[t].up(),!0)},t.prototype.set=function(t,e){this.keys={};for(var n in this.ctrlKeys)this.ctrlKeys.hasOwnProperty(n)&&(this.ctrlKeys[n]=!!(t&&t.hasOwnProperty(n)&&t[n]));for(var o=0,r=e;o<r.length;o++){var s=r[o];this.keys[s]=new w}this.length=e.length},t.prototype.getKeysAscii=function(){return Object.keys(this.keys)},t}(),C=function(){function t(t,e,n,o,r){this.name=t,this.started=!1;var s=this.getAsciiCodes(n);s&&(this.inputs=new b(e,s),this.defaultInputs={ctrlKeys:e,asciiCodes:s},this.callback=o,r&&(this.callback=this.callback.bind(r)),this.log=k.addGroup("Krait"),this.log.info("Added new command "+this.name))}return t.prototype.start=function(t){return!!this.inputs.start(t)&&(this.started=!0,this.callback(this.started),this.started)},t.prototype.stop=function(t){return!(!this.inputs.stop(t)||!this.started)&&(this.started=!1,this.callback(this.started),!0)},t.prototype.setInputs=function(t,e){var n=this.getAsciiCodes(e);return!!n&&(this.inputs.set(t,n),this.log.info(this.name+" is now set to "+JSON.stringify(n)),!0)},t.prototype.getInputsAscii=function(){return this.inputs.getKeysAscii()},t.prototype.default=function(){this.inputs.set(this.defaultInputs.ctrlKeys,this.defaultInputs.asciiCodes),this.log.info(this.name+" is now set to default"+JSON.stringify(this.defaultInputs.asciiCodes))},t.prototype.getAsciiCodes=function(t){for(var e=[],n=0,o=t;n<o.length;n++){var r=o[n],s=this.inputValidation(r);if(!s)return!1;e.push(s)}return e},t.prototype.inputValidation=function(t){return o(t,!1)||(t=y.toASCII(t)),n(t)?t:(this.log.error(t+" is not assignable to a valid ASCII code"),!1)},t}(),E=function(){function t(t){this.name=t,this.commands=[],this.listen=!1}return t.prototype.down=function(t){if(this.listen)for(var e=0,n=this.commands;e<n.length;e++)n[e].start(t)},t.prototype.up=function(t){if(this.listen)for(var e=0,n=this.commands;e<n.length;e++)n[e].stop(t)},t.prototype.start=function(){return this.listen=!0},t.prototype.stop=function(){return this.listen=!1,!0},t.prototype.addCommand=function(t,e,n,o,r){var s=new C(t,e,n,o,r);return this.commands.push(s),this.commands=this.sortCommands(this.commands),s},t.prototype.setInputs=function(t,e,n){var o=this.getCommand(t);return!!o&&(o.setInputs(e,n),this.commands=this.sortCommands(this.commands),!0)},t.prototype.default=function(t){var e=this.getCommand(t);return!!e&&(e.default(),this.commands=this.sortCommands(this.commands),!0)},t.prototype.sortCommands=function(t){return t.sort(function(t,e){return e.inputs.length-t.inputs.length}),t},t.prototype.getCommand=function(t){for(var e=0,n=this.commands;e<n.length;e++){var o=n[e];if(o.name==t)return o}return null},t.prototype.getCommandInputsAscii=function(t){var e=this.getCommand(t);return!!e&&e.getInputsAscii()},t}(),I=function(){function t(){this.initListeners(),this.groups=[]}return t.prototype.initListeners=function(){var t=this;document.onkeydown=function(e){t.down(e)},document.onkeyup=function(e){t.up(e)}},t.prototype.down=function(t){for(var e=0,n=this.groups;e<n.length;e++)n[e].down(t)},t.prototype.up=function(t){for(var e=0,n=this.groups;e<n.length;e++)n[e].up(t.which)},t.prototype.start=function(t){var e=this.getGroup(t);return!!e&&e.start()},t.prototype.stop=function(t){var e=this.getGroup(t);return!!e&&e.stop()},t.prototype.addCommand=function(t,e,n,o,r,s){var i=this.getGroup(t);return i||(i=new E(t),this.groups.push(i)),i.addCommand(e,n,o,r,s)},t.prototype.setInputs=function(t,e,n,o){var r=this.getGroup(t);return!!r&&r.setInputs(e,n,o)},t.prototype.default=function(t,e){var n=this.getGroup(t);return!!n&&n.default(e)},t.prototype.getGroup=function(t){for(var e=0,n=this.groups;e<n.length;e++){var o=n[e];if(o.name==t)return o}return null},t.prototype.getCommand=function(t,e){var n=this.getGroup(t);return n?n.getCommand(e):null},t.prototype.getCommandInputsAscii=function(t,e){var n=this.getCommand(t,e);return!!n&&n.getInputsAscii()},t}();return t.Keyboard=I,t}({});